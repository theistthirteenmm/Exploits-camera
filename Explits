import os
import socket

import requests


class Hamed:
    def __init__(self, file_path, search_word, output_file):
        self.file_path = file_path
        self.search_word = search_word
        self.output_file = output_file

    def attack(self):
        if os.path.exists(self.file_path):
            with open(self.file_path, 'r') as f:
                for line in f:
                    site_url = line.strip()
                    try:
                        if site_url.lower().startswith("http"):
                            response = requests.get(site_url)
                            response.raise_for_status()
                        else:
                            ip_address = socket.gethostbyname(site_url)
                            response = requests.get(f"http://{ip_address}")
                            response.raise_for_status()
                        print(f"سایت {site_url} وجود دارد.")
                        lines = response.text.splitlines()
                        found_urls = []
                        for line in lines:
                            if self.search_word in line:
                                url = line
                                if url not in found_urls:
                                    found_urls.append(url)
                        if found_urls:
                            with open(self.output_file, 'w') as f:
                                for url in found_urls:
                                    f.write(url + "=====>" + ip_address + '\n')
                            print(
                                f"آدرس صفحاتی که واژه '{self.search_word}' در آن‌ها یافت شد، در فایل '{self.output_file}' ذخیره شد.")
                        else:
                            print(
                                f"واژه‌ی '{self.search_word}' در سورس صفحه‌ی وب  یافت نشد.")
                    except Exception as e:
                        print(f"خطا: {str(e)}")

                    except Exception:
                        try:
                            response = requests.get(site_url)
                            response.raise_for_status()
                            print(f"سایت {site_url} وجود دارد.")
                        except Exception as e:
                            print(f"سایت {site_url} یافت نشد. خطا: {str(e)}")
        else:
            print("فایل مورد نظر وجود ندارد.")
